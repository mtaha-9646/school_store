{% macro render_item_grid(items, mode='checkout') %}
<div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3" id="item-grid">
    {% for item in items %}
    <div class="col item-card" data-search="{{ item.name.lower() }} {{ item.sku.lower() }} {{ item.barcode }}">
        <div class="card h-100 shadow-sm border-0 item-hover-effect">
            <div class="position-relative">
                <div class="d-flex align-items-center justify-content-center bg-light rounded-top"
                    style="height: 120px;">
                    <i
                        class="bi bi-box-seam display-4 text-{{ 'primary' if item.stock_on_hand > 10 else 'danger' }} opacity-50"></i>
                </div>
                <!-- Stock Badge -->
                <div class="position-absolute top-0 end-0 m-2">
                    <span
                        class="badge bg-{{ 'success' if item.stock_on_hand > 10 else 'danger' }} rounded-pill shadow-sm">
                        {{ item.stock_on_hand }}
                    </span>
                </div>
            </div>

            <div class="card-body p-2 text-center">
                <h6 class="card-title text-truncate mb-1 fw-bold" title="{{ item.name }}">{{ item.name }}</h6>
                <small class="text-muted d-block mb-2 font-monospace">{{ item.sku }}</small>

                {% if mode == 'checkout' %}
                {% if item.stock_on_hand > 0 %}
                <button class="btn btn-primary btn-sm w-100 rounded-pill"
                    onclick="selectItem('{{ item.id }}', '{{ item.name }}', {{ item.stock_on_hand }})">
                    <i class="bi bi-plus-lg me-1"></i>Add
                </button>
                {% else %}
                <button class="btn btn-secondary btn-sm w-100 rounded-pill" disabled>Out of Stock</button>
                {% endif %}
                {% else %}
                <!-- Restock Mode -->
                <button class="btn btn-outline-primary btn-sm w-100 rounded-pill"
                    onclick="openRestockModal('{{ item.id }}', '{{ item.name }}')">
                    <i class="bi bi-plus-circle me-1"></i>Add Stock
                </button>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Empty State (Hidden by default, shown by JS filter) -->
<div id="no-results" class="text-center py-5 d-none">
    <i class="bi bi-search display-1 text-muted opacity-25"></i>
    <p class="text-muted mt-3">No items match your search.</p>
</div>

<script>
    function filterGrid() {
        const query = document.getElementById('grid-search').value.toLowerCase();
        const cards = document.querySelectorAll('.item-card');
        let hasResults = false;

        cards.forEach(card => {
            const text = card.getAttribute('data-search');
            if (text.includes(query)) {
                card.classList.remove('d-none');
                hasResults = true;
            } else {
                card.classList.add('d-none');
            }
        });

        document.getElementById('no-results').classList.toggle('d-none', hasResults);
    }

    // Attach listener if input exists
    document.addEventListener('DOMContentLoaded', () => {
        const input = document.getElementById('grid-search');
        if (input) input.addEventListener('keyup', filterGrid);
    });
</script>

<style>
    .item-hover-effect {
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .item-hover-effect:hover {
        transform: translateY(-3px);
        box-shadow: 0 .5rem 1rem rgba(0, 0, 0, .15) !important;
    }
</style>
{% endmacro %}